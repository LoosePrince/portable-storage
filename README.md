# Portable Storage

## 项目简介

**Portable Storage** 是一个基于 [Fabric](https://fabricmc.net/) 和 [Fabric API](https://www.curseforge.com/minecraft/mc-mods/fabric-api) 的 Minecraft 模组，添加一个随身仓库。

## 主要特性

这个mod将为玩家背包UI的上方添加一个仓库界面，该界面顶部有一个搜索栏，下方是仓库界面用于显示仓库的中存放的物品，可以拿取和放入物品

仓库界面左侧有一列升级槽位（5个槽位），可以放入一些物品以升级仓库功能，右侧是仓库设置

## 模组UI

<img width="1153" height="1111" alt="image" src="https://github.com/user-attachments/assets/4d751127-eda9-40a2-9191-b466d3901880" />


### 升级（放入升级槽位的物品，点击槽位右上角角标可停用）：

- 工作台（minecraft:crafting_table）：在工作台界面的背包底部同样添加仓库的界面，并且支持合成补充
- 漏斗（minecraft:hopper）：自动拾取周围5格范围的掉落物到背包
- 箱子（minecraft:chest）：将玩家（的仓库）视为容器，如玩家站在漏斗上时会将仓库中的物品漏到漏斗中（头顶漏斗则会被漏入仓库）
- 木桶（minecraft:barrel）：放入槽位后升级为带有绑定的特殊容器，取出槽位后作为方块放置，右键打开在里面放入物品，其它自动化方块可以从该容器直接从玩家仓库中取出容器中有的物品（容器中方的物品不会被取出）或者向其玩家仓库输入物品；放入其它玩家的绑定木桶则会与对方共享仓库（仓库合并显示，取出双方皆有物品时优先从自己仓库数据中取出和存入），一个玩家的绑定木桶多次绑定分给多个玩家，当玩家的木桶升级槽位是其它玩家的绑定木桶时该玩家的绑定木桶无法在其它玩家的升级槽中生效，且不能两个玩家交换绑定木桶放入升级槽（一个玩家放了后另一个玩家就无法放入）
- 潜影盒（minecraft:shulker_box）：暂无

## 木桶升级示例情况

### 基础绑定流程

**情况1：首次绑定木桶**
1. 玩家A将普通木桶放入升级槽位
2. 木桶自动绑定到玩家A，成为"绑定木桶"
3. 玩家A可以将绑定木桶从升级槽位取出作为方块放置到世界中

**情况2：绑定木桶的转移**
1. 玩家A将绑定木桶从升级槽位取出
2. 绑定木桶作为物品丢出
3. 玩家B拾取这个绑定木桶
4. 玩家B将绑定木桶放入自己的升级槽位
5. 现在玩家B的仓库与玩家A的仓库共享

### 仓库共享机制

**情况3：仓库合并显示**
- 当玩家B使用玩家A的绑定木桶时：
  - 玩家B的仓库界面会显示两个仓库的合并内容
  - 取物品时优先从玩家B自己的仓库中取出
  - 存物品时优先存入玩家B自己的仓库

**情况4：多玩家绑定**
- 玩家A的绑定木桶可以分给多个玩家（玩家B、玩家C、玩家D）
- 每个玩家都可以在自己的升级槽位中使用这个绑定木桶
- 所有使用该绑定木桶的玩家都会共享仓库（所有人都会合并显示玩家A、玩家B、玩家C、玩家D的仓库）

### 限制和约束

**情况5：链式共享阻断**
- 如果玩家B已经将玩家A的绑定木桶放入升级槽位
- 玩家C就无法再将玩家B的绑定木桶放入升级槽位（即使已放入也没有效果）
- 系统会阻止链式共享

**情况6：循环共享阻断**
- 玩家A和玩家B不能互相交换绑定木桶
- 如果玩家A已经使用了玩家B的绑定木桶
- 玩家B就无法再使用玩家A的绑定木桶（即使已放入槽位也没有效果，因为两个玩家的仓库已经处于共享状态）

### 自动化设备交互

**情况7：自动化设备访问**
1. 将绑定木桶作为方块放下
2. 右键打开绑定木桶方块，在里面放入物品
3. 自动化设备（如漏斗）可以从绑定木桶中取出玩家A仓库中的物品（木桶内指定的物品）
- 其他自动化方块（如漏斗、投掷器）可以：
  - 从绑定木桶中取出玩家仓库中存在的物品
  - 向绑定木桶输入物品到玩家仓库
  - 绑定木桶中的物品不会被自动取出

### 设置：

以下设置在在客户端保存,重启游戏和切换界面不会丢失设置

- 折叠仓库：将这个拓展的仓库界面折叠为一个选项卡
- 排序方案：数量、物品名称、mod id、更新时间，正序反序，点击切换，在设置使用  "排序(数量)" 和 "排序(正序)" 两个点击切换模式
- 合成补充：合成时自动从仓库中补充物品到合成界面(即在背包页面中合成时自动补充物品到1组以连续合成),在设置使用 "合成补充(启用)" 格式以显示状态
- 自动传入：使用快捷键移动物品时优先传入仓库（shift + 左键点击物品）而不是在背包和快捷栏中移动,在设置使用 "自动传入(启用)" 格式以显示状态
- 搜索位置：默认底部，点击切换顶部、中间


底部：当前的在仓库ui下面
顶部：在玩家背包ui上面
顶部2：在玩家背包ui上面，但是更加靠上一些
中间：仓库ui下调，插入到鉴于玩家背包ui和仓库ui之间

## 系统要求

- **Minecraft 版本**：1.21
- **Java 版本**：Java 21 或更高
- **Fabric Loader**：0.17.2 或更高
- **Fabric API**：0.102.0+1.21 或兼容版本

## 安装方法

1. 安装 [Fabric Loader](https://fabricmc.net/use/) 和 [Fabric API](https://www.curseforge.com/minecraft/mc-mods/fabric-api)。
2. 下载本模组的 jar 文件，放入 `mods` 文件夹。
3. 启动游戏，模组会自动加载。

## 配置说明

- 无

## 开发与贡献

欢迎提交 Issue 或 PR 参与开发！

### 开发指南

- **事件系统**：使用 Fabric 事件系统进行功能交互
- **本地化**：支持中文和英文，所有文本均在 `lang` 文件中定义

### 调试提示

- 使用`./gradlew build` 编译
- 使用 `./gradlew clean` 清理缓存，使用 `./gradlew --stop` 停止和清理
- 使用 `./gradlew runClient` 启动开发客户端
- 使用 `./gradlew runDatagen` 生成数据文件
- 配置文件位于 `run/config/looseprinces-tool.toml`
- 日志文件位于 `run/logs/` 目录
- 使用 `--offline` 以离线编译，速度更快，第一次运行不要使用此参数

## 致谢与协议

- 本项目由 LoosePrince 开发，遵循 MIT 协议。
- 感谢 Fabric 社区及所有开源贡献者。

---

如有建议或问题，欢迎在 Issue 区留言反馈！
