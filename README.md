# Portable Storage

## 项目简介

**Portable Storage** 是一个基于 [Fabric](https://fabricmc.net/) 和 [Fabric API](https://www.curseforge.com/minecraft/mc-mods/fabric-api) 的 Minecraft 模组，为玩家提供随身仓库功能。仓库目前采用无限堆叠设计，按物品变体（含组件和NBT数据）进行智能存储，支持多玩家共享和自动化设备交互。

## 主要特性

这个模组为玩家背包UI上方添加一个仓库界面，界面顶部有搜索栏（支持搜索物品名称、模组ID、物品描述），下方显示仓库中存放的物品，可以自由拿取和放入物品。

仓库界面左侧有5个升级槽位，可以放入特定物品以解锁仓库的额外功能，右侧是仓库设置面板。

## 模组UI

<!-- <img width="1153" height="1111" alt="image" src="https://github.com/user-attachments/assets/4d751127-eda9-40a2-9191-b466d3901880" /> -->
<img width="1204" height="1049" alt="42a13c3fdfdecd3f477c93942435c204" src="https://github.com/user-attachments/assets/1eae7b0b-da81-47e6-b028-f1a42a54937a" />



### 升级（放入升级槽位的物品，右键升级槽位可停用）：

- **工作台**：在工作台界面底部显示仓库界面，支持合成补充功能（自动从仓库补充物品到合成格）
- **漏斗**：自动拾取周围5格范围内的掉落物到仓库中
- **箱子**：暂未实现
- **木桶**：创建绑定容器，支持多玩家仓库共享和自动化设备访问：
  - 放入槽位后升级为带有绑定的特殊容器
  - 取出槽位后作为方块放置，右键打开可存入物品到仓库
  - 自动化设备可以从绑定木桶中提取/存入玩家仓库物品
  - 放入其它玩家的绑定木桶可与其共享仓库（合并显示）
  - 支持多玩家共享同一仓库，但有防循环机制
- **潜影盒**：暂未实现

## 木桶升级使用说明

### 绑定机制

**首次绑定**
1. 玩家A将普通木桶放入升级槽位
2. 木桶自动绑定到玩家A，成为"绑定木桶"
3. 玩家A可以将绑定木桶从升级槽位取出作为方块放置到世界中

**绑定转移**
1. 玩家A将绑定木桶从升级槽位取出
2. 绑定木桶作为物品丢出或交易给其他玩家
3. 玩家B拾取这个绑定木桶并放入自己的升级槽位
4. 现在玩家B的仓库与玩家A的仓库共享（合并显示）

### 仓库共享机制

**共享显示**
- 当玩家B使用玩家A的绑定木桶时，玩家的仓库界面会显示合并后的物品列表
- 物品的提取和存入遵循优先级：优先操作自己的仓库
- 支持多玩家同时共享同一仓库组

**多玩家共享**
- 玩家A的绑定木桶可以被多个玩家同时使用
- 所有使用该绑定木桶的玩家都共享同一个仓库视图
- 系统会自动处理物品的同步和一致性

### 自动化设备交互

**绑定木桶方块**
1. 将绑定木桶作为方块放置到世界中
2. 右键打开可以手动存入物品到共享仓库
3. 自动化设备（如漏斗）可以：
   - 从绑定木桶中提取仓库内存在的物品
   - 向绑定木桶输入物品到共享仓库
   - 绑定木桶内的物品不会被自动化设备取出（需放入0号槽位作为标记）

### 限制机制

**防循环共享**
- 系统防止玩家间形成循环共享关系
- 如果玩家B已经使用了玩家A的绑定木桶，玩家A就无法再使用玩家B的绑定木桶
- 避免无限循环的仓库共享链

### 客户端设置

以下设置保存在客户端，重启游戏和切换界面不会丢失：

- **折叠仓库**：将仓库界面折叠为一个选项卡形式显示
- **排序方案**：支持四种排序方式：
  - 数量（按物品数量排列）
  - 物品名称（按字母顺序）
  - 模组ID（按模组名称）
  - 更新时间（最近操作的物品优先）
- **排序顺序**：可切换正序（升序）或倒序（降序）
- **合成补充**：在合成台界面使用时，自动从仓库补充物品到合成格，支持连续合成
- **自动传入**：使用Shift+左键点击物品时，优先将物品存入仓库而非背包或快捷栏
- **搜索位置**：调整搜索栏的位置：
  - 底部：显示在仓库UI下方
  - 顶部：在玩家背包UI上方（靠近）
  - 顶部2：在玩家背包UI上方（更靠上）
  - 中间：插入在背包UI和仓库UI之间

## 系统要求

- **Minecraft 版本**：1.21
- **Java 版本**：Java 21 或更高
- **Fabric Loader**：0.17.2 或更高版本
- **Fabric API**：兼容版本（推荐最新稳定版）

## 适配

- **EMI**：1.1.10+1.21（仅在工作台升级时在工作台界面有效）

## 安装方法

1. 安装 [Fabric Loader](https://fabricmc.net/use/) 和 [Fabric API](https://www.curseforge.com/minecraft/mc-mods/fabric-api)。
2. 下载本模组的 jar 文件，放入 `mods` 文件夹。
3. 启动游戏，模组会自动加载。

## 配置说明

- 无

## 开发与贡献

欢迎提交 Issue 或 PR 参与开发！

### 开发指南

- **事件系统**：使用 Fabric 事件系统进行功能交互
- **本地化**：支持中文和英文，所有文本均在 `lang` 文件中定义

### 开发提示

- 使用 `./gradlew build` 编译项目
- 使用 `./gradlew clean` 清理构建缓存
- 使用 `./gradlew runClient` 启动开发客户端进行测试
- 使用 `./gradlew runDatagen` 生成数据文件
- 使用 `./gradlew --stop` 停止Gradle守护进程
- 配置文件位于 `run/config/` 目录（包括模组配置）
- 日志文件位于 `run/logs/` 目录
- 使用 `--offline` 参数进行离线编译（首次运行需要联网下载依赖）

## 致谢与协议

- 本项目由 LoosePrince 开发，遵循 MIT 协议。
- 感谢 Fabric 社区及所有开源贡献者。

---

如有建议或问题，欢迎在 Issue 区留言反馈！
