# Portable Storage 配置说明

## 服务端配置

服务端配置文件位于：`config/portable-storage-server.toml`

### 配置文件示例

```toml
# Portable Storage 服务端配置文件
# 此配置文件控制服务端行为，修改后需要重启服务器生效

[storage]
# 是否需要条件启用玩家随身仓库
# 启用后玩家的随身仓库不再是默认就有的，而是需要达成条件才会有
# 默认值: true
require_condition_to_enable = true

# 启用玩家随身仓库的道具
# 启用"需要条件启用玩家随身仓库"后用以启用玩家仓库的物品，手持右键以启用
# 默认值: "minecraft:nether_star" (下界之星)
# 格式: "命名空间:物品ID"
enable_item = "minecraft:nether_star"

# 启用玩家随身仓库的道具是否消耗
# 开启后启用玩家随身仓库时会消耗该物品一个
# 默认值: true
consume_enable_item = true

# 是否启用增量同步
# 启用后只同步发生变化的数据，减少网络传输量
# 可能存在BUG未发现或未修复的错误
# 默认值: false
enable_incremental_sync = false

# 是否启用按需同步
# 启用后仅在玩家打开/查看仓库界面时推送增量，否则遍历所有在线玩家
# 可显著降低负载，代价是非查看时可能有延迟
# 默认值: true
enable_on_demand_sync = true

# 增量同步发送间隔（以 tick 为单位）
# 数值越小，同步越及时；但网络与CPU负载越高
# 默认值: 2
incremental_sync_interval_ticks = 2

# 单个数据包包含的最大增量条目数（upserts+removes）
# 超过将拆分为多个包依次发送
# 默认值: 512
incremental_sync_max_entries = 512

# 启用仓库时是否清空现有数据
# 启用后使用仓库激活物品时会清空玩家现有的仓库数据
# 默认值: true
clear_storage_on_enable = true

# 是否启用裂隙功能
# 启用后玩家可以通过裂隙升级槽进入私人裂隙空间
# 禁用后无法进入裂隙，处于裂隙的玩家会在上线时被送回原位置
# 默认值: true
enable_rift_feature = true

# 裂隙升级物品
# 用于进入裂隙的升级槽物品，默认龙蛋
# 格式: "类型:命名空间:物品ID" (类型为 block 或 item)
# 默认值: "block:minecraft:dragon_egg"
rift_upgrade_item = "block:minecraft:dragon_egg"

# 裂隙大小
# 裂隙空间的大小，单位为区块（16x16方块）
# 默认值: 1
rift_size = 1

# 限制高度范围
# 启用后限制裂隙内的高度范围，启用上下回传和屏障封底顶
# 关闭后玩家可以在整个维度高度范围内建造
# 
# 限制模式（true）：
# - 可建造高度：Y=0 到 Y=163（共164层）
# - 底部Y=0-8层和顶部Y=155-163层会生成屏障方块作为边界保护
# - 玩家无法在限制范围外放置或破坏方块
# 
# 非限制模式（false）：
# - 可建造高度：Y=-64 到 Y=319（共384层，整个维度高度）
# - 不生成屏障方块，无高度限制
# - 玩家可以在整个维度高度范围内自由建造
# 
# 默认值: false
limit_rift_height = false

# 启用工作台虚拟合成功能
# 启用后工作台升级槽位提供3x3虚拟合成覆盖层
# 关闭后工作台升级槽位的虚拟合成描述也不会显示
# 默认值: true
enable_virtual_crafting = true

# 启用无限岩浆功能
# 启用后岩浆流体在仓库内数量大于阈值时数量显示∞（无限）
# 存取都不会使其数量变化
# 默认值: true
enable_infinite_lava = true

# 启用无限水功能
# 启用后水流体在仓库内数量大于阈值时数量显示∞（无限）
# 存取都不会使其数量变化
# 默认值: true
enable_infinite_water = true

# 无限岩浆阈值
# 岩浆流体数量大于此值时显示为无限
# 默认值: 10000
infinite_lava_threshold = 10000

# 无限水阈值
# 水流体数量大于此值时显示为无限
# 默认值: 2
infinite_water_threshold = 2

# 是否启用物品大小限制
# 启用后限制单个物品的大小，防止过大的物品存入存储
# 默认值: true
enable_size_limit = true

# 最大物品大小（字节）
# 单个物品的大小不能超过此值
# 默认值: 102400 (100KB)
max_storage_size_bytes = 102400

[container_display]
# 工作台升级在容器界面显示仓库的配置
# 启用工作台升级后，以下容器界面将显示仓库界面
# 默认值: 全部为 false

# 切石机
stonecutter = false
# 制图台
cartography_table = false
# 锻造台
smithing_table = false
# 砂轮
grindstone = false
# 织布机
loom = false
# 熔炉
furnace = false
# 烟熏炉
smoker = false
# 高炉
blast_furnace = false
# 铁砧
anvil = false
# 附魔台
enchanting_table = false
# 酿造台
brewing_stand = false
# 信标
beacon = false
# 箱子
chest = false
# 木桶
barrel = false
# 末影箱
ender_chest = false
# 潜影盒
shulker_box = false
# 发射器
dispenser = false
# 投掷器
dropper = false
# 合成器
crafter = false
# 漏斗
hopper = false
# 陷阱箱
trapped_chest = false
# 漏斗矿车
hopper_minecart = false
# 运输矿车
chest_minecart = false
# 运输船
chest_boat = false
# 运输竹筏
bamboo_chest_raft = false
```

### 服务端配置项说明

#### [storage] 部分

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `require_condition_to_enable` | boolean | false | 是否需要条件启用玩家随身仓库。启用后玩家需要达成条件才能使用随身仓库 |
| `enable_item` | string | "minecraft:nether_star" | 启用随身仓库的道具，格式为"命名空间:物品ID" |
| `consume_enable_item` | boolean | true | 启用随身仓库时是否消耗启用道具 |
| `enable_incremental_sync` | boolean | false | 是否启用增量同步，减少网络传输量（可能存在BUG） |
| `enable_on_demand_sync` | boolean | true | 是否按需同步：仅在玩家查看界面时推送，否则向所有在线玩家推送 |
| `incremental_sync_interval_ticks` | integer | 2 | 增量同步发送的 tick 间隔（越小越及时，负载越高） |
| `incremental_sync_max_entries` | integer | 512 | 单包最大增量条目数，超过会分包发送 |
| `clear_storage_on_enable` | boolean | true | 启用仓库时是否清空现有数据 |
| `enable_rift_feature` | boolean | true | 是否启用裂隙功能（禁用会无法进入且踢出已在裂隙的玩家） |
| `rift_upgrade_item` | string | "block:minecraft:dragon_egg" | 裂隙升级物品，格式为"类型:命名空间:物品ID" (类型为 block 或 item) |
| `rift_size` | integer | 1 | 裂隙空间的大小，单位为区块（16x16方块） |
| `limit_rift_height` | boolean | false | 是否限制裂隙高度范围（限制模式：Y=0-163，非限制模式：Y=-64-319） |
| `enable_virtual_crafting` | boolean | true | 是否启用工作台虚拟合成功能 |
| `enable_infinite_lava` | boolean | true | 是否启用无限岩浆功能 |
| `enable_infinite_water` | boolean | true | 是否启用无限水功能 |
| `infinite_lava_threshold` | integer | 10000 | 无限岩浆阈值，岩浆数量大于此值时显示为无限 |
| `infinite_water_threshold` | integer | 2 | 无限水阈值，水数量大于此值时显示为无限 |
| `enable_size_limit` | boolean | true | 是否启用物品大小限制 |
| `max_storage_size_bytes` | long | 102400 | 最大物品大小（字节），单个物品不能超过此值 |

#### [container_display] 部分

工作台升级功能允许在特定容器界面中显示仓库。以下配置项控制哪些容器界面会显示仓库：

| 配置项 | 对应容器 | 默认值 | 说明 |
|--------|----------|--------|------|
| `stonecutter` | 切石机 | false | 在切石机界面显示仓库 |
| `cartography_table` | 制图台 | false | 在制图台界面显示仓库 |
| `smithing_table` | 锻造台 | false | 在锻造台界面显示仓库 |
| `grindstone` | 砂轮 | false | 在砂轮界面显示仓库 |
| `loom` | 织布机 | false | 在织布机界面显示仓库 |
| `furnace` | 熔炉 | false | 在熔炉界面显示仓库 |
| `smoker` | 烟熏炉 | false | 在烟熏炉界面显示仓库 |
| `blast_furnace` | 高炉 | false | 在高炉界面显示仓库 |
| `anvil` | 铁砧 | false | 在铁砧界面显示仓库 |
| `enchanting_table` | 附魔台 | false | 在附魔台界面显示仓库 |
| `brewing_stand` | 酿造台 | false | 在酿造台界面显示仓库 |
| `beacon` | 信标 | false | 在信标界面显示仓库 |
| `chest` | 箱子 | false | 在箱子界面显示仓库 |
| `barrel` | 木桶 | false | 在木桶界面显示仓库 |
| `ender_chest` | 末影箱 | false | 在末影箱界面显示仓库 |
| `shulker_box` | 潜影盒 | false | 在潜影盒界面显示仓库 |
| `dispenser` | 发射器 | false | 在发射器界面显示仓库 |
| `dropper` | 投掷器 | false | 在投掷器界面显示仓库 |
| `crafter` | 合成器 | false | 在合成器界面显示仓库 |
| `hopper` | 漏斗 | false | 在漏斗界面显示仓库 |
| `trapped_chest` | 陷阱箱 | false | 在陷阱箱界面显示仓库 |
| `hopper_minecart` | 漏斗矿车 | false | 在漏斗矿车界面显示仓库 |
| `chest_minecart` | 运输矿车 | false | 在运输矿车界面显示仓库 |
| `chest_boat` | 运输船 | false | 在运输船界面显示仓库 |
| `bamboo_chest_raft` | 运输竹筏 | false | 在运输竹筏界面显示仓库 |

## 客户端配置

客户端配置文件位于：`config/portable-storage-client.json`

### 配置文件示例

```json
{
  "collapsed": false,
  "sortMode": "COUNT",
  "sortAscending": false,
  "craftRefill": true,
  "autoDeposit": false,
  "smartCollapse": false,
  "searchPos": "BOTTOM",
  "storagePos": "BOTTOM",
  "virtualCraftingVisible": false,
  "maxVisibleRows": 6,
  "favorites": [],
  "pinyinSearch": true,
  "polyphoneMap": {
    "镐": ["gao", "hao"]
  }
}
```

### 客户端配置项说明

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `collapsed` | boolean | false | 仓库界面是否折叠显示 |
| `sortMode` | string | "COUNT" | 物品排序方式，可选值：COUNT（数量）、NAME（名称）、MOD_ID（模组ID）、UPDATE_TIME（更新时间） |
| `sortAscending` | boolean | false | 排序是否升序（false=降序，true=升序） |
| `craftRefill` | boolean | true | 是否启用合成补充功能 |
| `autoDeposit` | boolean | false | 是否启用自动传入功能 |
| `smartCollapse` | boolean | false | 是否启用智能折叠（按物品ID折叠不同NBT但同ID的物品） |
| `searchPos` | string | "BOTTOM" | 搜索框位置，可选值：BOTTOM（仓库UI下面）、TOP（玩家背包上方）、TOP2（玩家背包上方更靠上）、MIDDLE（背包与仓库之间） |
| `storagePos` | string | "BOTTOM" | 仓库位置，可选值：BOTTOM（底部）、TOP（顶部） |
| `virtualCraftingVisible` | boolean | false | 虚拟合成界面是否可见 |
| `maxVisibleRows` | integer | 6 | 最大可见行数 |
| `favorites` | array | [] | 收藏（星标）物品列表，以物品ID（namespace:id）标识 |
| `pinyinSearch` | boolean | true | 是否启用拼音搜索功能 |
| `polyphoneMap` | object | 见下方说明 | 多音字映射表，支持热修改 |

### 排序模式说明

- **COUNT**: 按物品数量排序
- **NAME**: 按物品名称排序
- **MOD_ID**: 按模组ID排序
- **UPDATE_TIME**: 按更新时间排序

### 搜索位置说明

- **BOTTOM**: 搜索框位于仓库UI下方
- **TOP**: 搜索框位于玩家背包上方（靠近）
- **TOP2**: 搜索框位于玩家背包上方（更靠上）
- **MIDDLE**: 搜索框插入在背包与仓库之间

### 仓库位置说明

- **BOTTOM**: 仓库界面位于底部（默认）
- **TOP**: 仓库界面位于顶部

### 收藏功能说明

收藏功能允许玩家将常用物品标记为星标，这些物品会优先显示在仓库中：

- `favorites` 数组包含收藏的物品ID，格式为 `"命名空间:物品ID"`
- 例如：`["minecraft:diamond", "minecraft:iron_ingot"]`
- 收藏的物品会在仓库界面中显示星标图标
- 支持在游戏内动态添加/移除收藏，配置会自动保存

### 多音字映射说明

多音字映射表用于拼音搜索功能，解决中文多音字搜索问题：

- `polyphoneMap` 对象中，键为汉字，值为该字的所有可能拼音数组
- 例如：`"镐": ["gao", "hao"]` 表示"镐"字可以读作"gao"或"hao"
- 常用多音字示例：
  - `"长": ["chang", "zhang"]` - 长度/成长
  - `"重": ["chong", "zhong"]` - 重复/重量
  - `"行": ["hang", "xing"]` - 银行/行走
